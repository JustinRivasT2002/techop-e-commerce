<!-- Navbar -->
<nav class="navbar">
  <div class="navbar-brand">
    <a routerLink="/">Techop</a>
  </div>
  <ul class="navbar-links">
    <li><a routerLink="/about-us">Sobre Nosotros</a></li>
    <li><a routerLink="/products">Productos</a></li>
    <li><a routerLink="/account">Cuenta</a></li>
    <li><a routerLink="/cart">Carrito de Compra</a></li>
  </ul>
</nav>

<body>
  <div class="carrito-container">
    <h2>Carrito de Compra</h2>

    <div *ngIf="productosCarrito && productosCarrito.length > 0; else vacio">
      <div *ngFor="let producto of productosCarrito" class="producto-carrito">
        <img *ngIf="producto.imagen" [src]="producto.imagen" [alt]="producto.nombre || 'Producto'" class="producto-img" />

        <div class="producto-info">
          <h3>{{ producto.nombre || 'Sin nombre' }}</h3>

          <div class="cantidad-control">
            <button (click)="reducir(producto.id)">‚àí</button>
            <span>{{ producto.cantidad }}</span>
            <button (click)="aumentar(producto.id)">+</button>
          </div>
        </div>

        <div class="producto-precio">
          <p><strong>{{ (producto.precio * producto.cantidad) | currency:'EUR' }}</strong></p>
        </div>
      </div>

      <div class="total-carrito">
        <p><strong>Total:</strong> {{ totalCarrito | currency:'EUR' }}</p>
      </div>

      <!-- Bot√≥n para finalizar compra -->
      <button class="finalizar-btn" (click)="mostrarPopup()">Continuar</button>
    </div>

    <!-- Popup de confirmaci√≥n -->
    <div class="popup" *ngIf="mostrarResumen">
      <div class="popup-content">
        <h2>Confirmar Compra</h2>

        <label>Nombre Completo:</label>
        <input type="text" [(ngModel)]="nombreUsuario">
        <p *ngIf="intentoEnvio && !nombreUsuario" class="error-msg">‚ö†Ô∏è Este campo es obligatorio.</p>

        <label>Email:</label>
        <input type="email" [(ngModel)]="emailUsuario" required>
        <p *ngIf="intentoEnvio && !emailUsuario" class="error-msg">‚ö†Ô∏è Este campo es obligatorio.</p>
        <p *ngIf="intentoEnvio && emailUsuario && !validarEmail()" class="error-msg">‚ö†Ô∏è Introduce un correo v√°lido.</p>

        <label>Tel√©fono:</label>
        <input type="number" [(ngModel)]="telefonoUsuario" inputmode="numeric" pattern="[0-9]*">
        <p *ngIf="intentoEnvio && !telefonoUsuario" class="error-msg">‚ö†Ô∏è Este campo es obligatorio.</p>
        <p *ngIf="intentoEnvio && telefonoUsuario && !validarTelefono()" class="error-msg">‚ö†Ô∏è Introduce un n√∫mero de tel√©fono v√°lido.</p>

        <label>Direcci√≥n:</label>
        <input type="text" [(ngModel)]="direccionUsuario">
        <p *ngIf="intentoEnvio && !direccionUsuario" class="error-msg">‚ö†Ô∏è Este campo es obligatorio.</p>

        <label>M√©todo de Pago:</label>
        <select [(ngModel)]="metodoPagoId">
          <option *ngFor="let metodo of metodosPago" [value]="metodo.id">{{ metodo.nombre }}</option>
        </select>
        <p *ngIf="intentoEnvio && !metodoPagoId" class="error-msg">‚ö†Ô∏è Debes seleccionar un m√©todo de pago.</p>

        <p><strong>Total a pagar:</strong> {{ totalCarrito | currency:'EUR' }}</p>

        <button class="finalizar-btn" (click)="finalizarCompra()">Finalizar compra</button>
        <button class="confirmar-btn" (click)="cerrarPopup()">Cancelar</button>
      </div>
    </div>

    <!-- Popup de confirmaci√≥n antes de enviar la compra -->
    <div class="popup" *ngIf="mostrarPopupConfirmacionBoleano">
      <div class="popup-content">
        <h2>üõí Resumen del Pedido</h2>

        <p><strong>üìß Email:</strong> {{ emailUsuario }}</p>
        <p><strong>üë§ Nombre:</strong> {{ nombreUsuario }}</p>
        <p><strong>üìû Tel√©fono:</strong> {{ telefonoUsuario }}</p>
        <p><strong>üè† Direcci√≥n:</strong> {{ direccionUsuario }}</p>
        <p><strong>üí≥ M√©todo de Pago:</strong> {{ getNombreMetodoPago() }}</p>

        <h3>üõçÔ∏è Productos:</h3>
        <ul>
          <li *ngFor="let producto of productosCarrito">
            {{ producto.nombre }} (x{{ producto.cantidad }}) - {{ producto.precio * producto.cantidad | currency:'EUR' }}
          </li>
        </ul>

        <p><strong>üí∞ Total a pagar:</strong> {{ totalCarrito | currency:'EUR' }}</p>

        <button class="confirmar-btn" (click)="confirmarCompra()">Confirmar compra</button>
        <button class="cancelar-btn" (click)="cerrarPopupConfirmacion()">Cancelar</button>
      </div>
    </div>

    <ng-template #vacio>
      <div class="carrito-vacio">
        <p>üõí Tu carrito est√° vac√≠o.</p>
        <a routerLink="/products" class="volver-productos">Explorar productos</a>
      </div>
    </ng-template>
  </div>
</body>

<footer class="footer">
  <div class="footer-content">
    <div class="footer-column">
      <h4>Techop</h4>
      <ul>
        <li><a routerLink="/products">Productos</a></li>
        <li><a routerLink="/about-us">Sobre Nosotros</a></li>
        <li><a routerLink="/account">Cuenta</a></li>
        <li><a routerLink="/cart">Carrito</a></li>
      </ul>
    </div>

    <div class="footer-column">
      <h4>Atenci√≥n al Cliente</h4>
      <ul>
        <li><a href="#">Preguntas Frecuentes</a></li>
        <li><a href="#">T√©rminos y Condiciones</a></li>
        <li><a href="#">Pol√≠tica de Privacidad</a></li>
        <li><a href="#">Contacto</a></li>
      </ul>
    </div>

    <div class="footer-column">
      <h4>M√©todos de Pago</h4>
      <div class="payment-methods">
        <img src="assets/img/visa.svg" alt="Visa">
        <img src="assets/img/mastercard.svg" alt="Mastercard">
        <img src="assets/img/paypal.svg" alt="PayPal">
        <img src="assets/img/applePay.svg" alt="apple-pay">
      </div>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; {{ currentYear }} Techop E-commerce. Todos los derechos reservados.</p>
  </div>
</footer>
